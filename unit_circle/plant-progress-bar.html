<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Plant Progress Bar â€” Module</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital@0;1&family=Crimson+Pro:wght@300;400;600&display=swap" rel="stylesheet">
<style>
/* =============================================
   PLANT PROGRESS BAR â€” MODULAR COMPONENT
   
   HOW TO INTEGRATE:
   1. Copy everything inside #progress-bar-module into your game's HTML
   2. Copy the CSS block marked [MODULE CSS]
   3. Copy the JS block marked [MODULE JS]
   4. Call: PlantProgress.addWater() â€” when a correct answer is given
   5. Listen for: document.addEventListener('plantFullyGrown', callback)
   6. Call: PlantProgress.reset() â€” to restart
   ============================================= */

  * { box-sizing: border-box; margin: 0; padding: 0; }

  /* Demo page wrapper â€” remove this in your game */
  body {
    background: #0f1a12;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-end;
    font-family: 'Crimson Pro', serif;
    padding-bottom: 0;
  }

  /* Demo controls â€” remove these in your game */
  .demo-area {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 20px;
    color: #6a9b70;
    font-family: 'Crimson Pro', serif;
  }
  .demo-area h2 {
    font-family: 'Playfair Display', serif;
    font-style: italic;
    color: #c8e6c9;
    font-size: 1.4rem;
    font-weight: 400;
  }
  .demo-area p { font-size: 0.9rem; letter-spacing: 0.05em; opacity: 0.7; }
  .demo-btn {
    padding: 10px 28px;
    background: #1a3a1e;
    border: 1px solid #3d7a4a;
    border-radius: 10px;
    color: #c8e6c9;
    font-family: 'Crimson Pro', serif;
    font-size: 1rem;
    cursor: pointer;
    letter-spacing: 0.08em;
    transition: all 0.2s;
  }
  .demo-btn:hover { background: #2a5634; }
  .demo-btn.reset { border-color: #5c3d1e; color: #a07850; }
  .demo-btn.reset:hover { background: #2a1a0a; }
  .demo-row { display: flex; gap: 12px; }

  /* =============================================
     [MODULE CSS] â€” Copy from here into your game
     ============================================= */

  #progress-bar-module {
    width: 100%;
    max-width: 900px;
    background: #0c1610;
    border-top: 1px solid #1e3a22;
    padding: 0 32px 0;
    display: flex;
    align-items: flex-end;
    gap: 0;
    position: relative;
    overflow: visible;
  }

  /* ---------- PLANT SIDE ---------- */
  .pb-plant-side {
    flex: 1;
    display: flex;
    align-items: flex-end;
    justify-content: center;
    padding-bottom: 0;
    position: relative;
  }

  #pb-plant-svg {
    width: 160px;
    height: 160px;
    overflow: visible;
    display: block;
  }

  /* Stem */
  #pb-stem {
    stroke: #3d7a4a;
    stroke-width: 3.5;
    stroke-linecap: round;
    fill: none;
    filter: drop-shadow(0 0 3px rgba(61,122,74,0.4));
    stroke-dasharray: 180;
    stroke-dashoffset: 180;
    transition: stroke-dashoffset 1s cubic-bezier(0.4,0,0.2,1);
  }

  .pb-leaf {
    transform-box: fill-box;
    transform: scale(0);
    transition: transform 0.6s cubic-bezier(0.34,1.56,0.64,1);
  }

  .pb-petal {
    transform-box: fill-box;
    transform-origin: center bottom;
    transform: scale(0);
    opacity: 0;
    transition: transform 0.4s cubic-bezier(0.34,1.56,0.64,1), opacity 0.4s;
  }

  .pb-flower-part {
    transform-box: fill-box;
    transform-origin: center;
    transform: scale(0);
    transition: transform 0.35s cubic-bezier(0.34,1.56,0.64,1);
  }

  /* ---------- DIVIDER ---------- */
  .pb-divider {
    width: 1px;
    height: 100px;
    background: linear-gradient(to bottom, transparent, #2a4d2e, transparent);
    align-self: center;
    flex-shrink: 0;
  }

  /* ---------- WATERING CAN SIDE ---------- */
  .pb-can-side {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-end;
    padding-bottom: 18px;
    gap: 10px;
    position: relative;
  }

  .pb-can-label {
    font-size: 0.75rem;
    color: #4a7c50;
    letter-spacing: 0.15em;
    text-transform: uppercase;
  }

  /* Watering can SVG wrapper */
  .pb-can-wrap {
    position: relative;
    cursor: pointer;
    transition: transform 0.15s;
  }

  .pb-can-wrap:hover { transform: scale(1.05); }

  .pb-can-wrap.full { cursor: pointer; }
  .pb-can-wrap.full #pb-can-svg { filter: drop-shadow(0 0 10px rgba(74,158,200,0.6)); }

  .pb-can-wrap:not(.full) { cursor: default; }
  .pb-can-wrap:not(.full):hover { transform: none; }

  #pb-can-svg {
    width: 110px;
    height: 90px;
    overflow: visible;
    transition: filter 0.4s;
  }

  /* Water fill inside can â€” clip path animated */
  #pb-water-fill {
    transition: y 0.5s cubic-bezier(0.4,0,0.2,1), height 0.5s cubic-bezier(0.4,0,0.2,1);
  }

  /* Water level dots */
  .pb-water-dots {
    display: flex;
    gap: 6px;
    align-items: center;
  }

  .pb-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: #1e3a22;
    border: 1px solid #2a4d2e;
    transition: background 0.3s, border-color 0.3s, transform 0.3s;
  }

  .pb-dot.filled {
    background: #3a9ad9;
    border-color: #5bc0f8;
    box-shadow: 0 0 6px rgba(58,154,217,0.5);
  }

  .pb-dot.just-filled {
    animation: dotPop 0.4s cubic-bezier(0.34,1.56,0.64,1);
  }

  @keyframes dotPop {
    0% { transform: scale(0); }
    100% { transform: scale(1); }
  }

  /* ---------- SPLASH EFFECT ---------- */
  .pb-splash-drop {
    position: absolute;
    border-radius: 50%;
    background: rgba(58,154,217,0.7);
    pointer-events: none;
    animation: splashDrop 0.7s ease-out forwards;
  }

  @keyframes splashDrop {
    0%   { opacity: 1; transform: scale(0) translate(0,0); }
    60%  { opacity: 0.8; }
    100% { opacity: 0; transform: scale(1) translate(var(--tx), var(--ty)); }
  }

  /* Water pour stream */
  .pb-pour-stream {
    position: absolute;
    width: 3px;
    border-radius: 2px;
    background: linear-gradient(to bottom, rgba(58,154,217,0.8), rgba(58,154,217,0.2));
    pointer-events: none;
    animation: pourStream 0.5s ease-in forwards;
    transform-origin: top center;
  }

  @keyframes pourStream {
    0%   { height: 0; opacity: 1; }
    70%  { height: 50px; opacity: 1; }
    100% { height: 50px; opacity: 0; transform: translateY(10px); }
  }

  /* Full can pulse ring */
  .pb-full-ring {
    position: absolute;
    inset: -8px;
    border-radius: 50%;
    border: 2px solid rgba(58,154,217,0.6);
    animation: fullRing 1.4s ease-out infinite;
    pointer-events: none;
  }

  @keyframes fullRing {
    0%   { transform: scale(0.9); opacity: 0.8; }
    100% { transform: scale(1.3); opacity: 0; }
  }

  /* ---------- STATUS TEXT ---------- */
  .pb-status {
    font-size: 0.8rem;
    color: #4a7c50;
    letter-spacing: 0.08em;
    font-style: italic;
    height: 18px;
    text-align: center;
    transition: color 0.3s;
  }

  .pb-status.highlight { color: #3a9ad9; }
  .pb-status.bloom { color: #f4a261; }

  /* Soil bar across the bottom */
  .pb-soil-bar {
    position: absolute;
    bottom: 0; left: 0; right: 0;
    height: 6px;
    background: linear-gradient(90deg, #3d2010, #5c3d1e, #7a5230, #5c3d1e, #3d2010);
  }

  /* ============================================= */
</style>
</head>
<body>

<!-- DEMO AREA (remove in your game) -->
<div class="demo-area">
  <h2>Your Math Game Lives Here</h2>
  <p>When a correct answer is submitted, call <code style="color:#5bc0f8">PlantProgress.addWater()</code></p>
  <div class="demo-row">
    <button class="demo-btn" onclick="PlantProgress.addWater()">âœ“ Correct Answer</button>
    <button class="demo-btn reset" onclick="PlantProgress.reset()">â†º Reset</button>
  </div>
  <p id="demo-event-log" style="color:#3a9ad9; min-height:20px;"></p>
</div>

<!-- =============================================
     [MODULE HTML] â€” Copy this into your game
     ============================================= -->
<div id="progress-bar-module">

  <!-- Plant side -->
  <div class="pb-plant-side">
    <svg id="pb-plant-svg" viewBox="0 0 160 160">
      <!-- Soil mound -->
      <ellipse cx="80" cy="155" rx="58" ry="9" fill="#5c3d1e"/>
      <ellipse cx="80" cy="151" rx="58" ry="8" fill="#7a5230"/>
      <circle cx="58" cy="149" r="2" fill="#5c3d1e" opacity="0.5"/>
      <circle cx="95" cy="148" r="1.5" fill="#5c3d1e" opacity="0.5"/>
      <circle cx="108" cy="150" r="2" fill="#5c3d1e" opacity="0.4"/>

      <!-- Seed -->
      <ellipse id="pb-seed" cx="80" cy="144" rx="5" ry="3.5" fill="#8B6914"/>

      <!-- Stem -->
      <path id="pb-stem" d="M80,148 C78,132 82,115 79,98 C76,80 81,62 80,44"/>

      <!-- Leaves -->
      <g id="pb-leaf-l1" class="pb-leaf" style="transform-origin: 78px 118px;">
        <path d="M78,122 C63,111 53,105 50,97 C59,96 73,102 78,115" fill="#2d6b3a"/>
        <path d="M78,122 C65,112 56,106 53,99 C62,98 74,104 78,117" fill="#4a9e5c"/>
        <line x1="78" y1="122" x2="53" y2="99" stroke="#2d6b3a" stroke-width="0.8" opacity="0.5"/>
      </g>
      <g id="pb-leaf-r1" class="pb-leaf" style="transform-origin: 81px 108px;">
        <path d="M81,110 C96,99 106,93 109,85 C100,84 87,90 81,103" fill="#2d6b3a"/>
        <path d="M81,110 C94,100 103,94 106,87 C97,86 86,92 81,105" fill="#4a9e5c"/>
        <line x1="81" y1="110" x2="105" y2="87" stroke="#2d6b3a" stroke-width="0.8" opacity="0.5"/>
      </g>
      <g id="pb-leaf-l2" class="pb-leaf" style="transform-origin: 79px 82px;">
        <path d="M79,85 C65,75 56,69 53,62 C62,61 75,67 79,80" fill="#2d6b3a"/>
        <path d="M79,85 C67,76 59,71 56,64 C65,63 76,69 79,82" fill="#4a9e5c"/>
        <line x1="79" y1="85" x2="56" y2="64" stroke="#2d6b3a" stroke-width="0.8" opacity="0.5"/>
      </g>

      <!-- Flower bloom glow -->
      <circle id="pb-bloom-glow" cx="80" cy="40" r="18" fill="#f9c784" opacity="0" filter="url(#pb-glow)"/>

      <!-- Flower petals -->
      <g id="pb-flower" transform="translate(80,40)">
        <ellipse class="pb-petal" id="pp0" cx="0" cy="-13" rx="6" ry="10" fill="#f4a261" transform="rotate(0)"/>
        <ellipse class="pb-petal" id="pp1" cx="0" cy="-13" rx="6" ry="10" fill="#e76f51" transform="rotate(45)"/>
        <ellipse class="pb-petal" id="pp2" cx="0" cy="-13" rx="6" ry="10" fill="#f4a261" transform="rotate(90)"/>
        <ellipse class="pb-petal" id="pp3" cx="0" cy="-13" rx="6" ry="10" fill="#e76f51" transform="rotate(135)"/>
        <ellipse class="pb-petal" id="pp4" cx="0" cy="-13" rx="6" ry="10" fill="#f4a261" transform="rotate(180)"/>
        <ellipse class="pb-petal" id="pp5" cx="0" cy="-13" rx="6" ry="10" fill="#e76f51" transform="rotate(225)"/>
        <ellipse class="pb-petal" id="pp6" cx="0" cy="-13" rx="6" ry="10" fill="#f4a261" transform="rotate(270)"/>
        <ellipse class="pb-petal" id="pp7" cx="0" cy="-13" rx="6" ry="10" fill="#e76f51" transform="rotate(315)"/>
        <ellipse class="pb-petal" id="pp8"  cx="0" cy="-8" rx="4" ry="7" fill="#f9c784" transform="rotate(22)"/>
        <ellipse class="pb-petal" id="pp9"  cx="0" cy="-8" rx="4" ry="7" fill="#f9c784" transform="rotate(67)"/>
        <ellipse class="pb-petal" id="pp10" cx="0" cy="-8" rx="4" ry="7" fill="#f9c784" transform="rotate(112)"/>
        <ellipse class="pb-petal" id="pp11" cx="0" cy="-8" rx="4" ry="7" fill="#f9c784" transform="rotate(157)"/>
        <ellipse class="pb-petal" id="pp12" cx="0" cy="-8" rx="4" ry="7" fill="#f9c784" transform="rotate(202)"/>
        <ellipse class="pb-petal" id="pp13" cx="0" cy="-8" rx="4" ry="7" fill="#f9c784" transform="rotate(247)"/>
        <ellipse class="pb-petal" id="pp14" cx="0" cy="-8" rx="4" ry="7" fill="#f9c784" transform="rotate(292)"/>
        <ellipse class="pb-petal" id="pp15" cx="0" cy="-8" rx="4" ry="7" fill="#f9c784" transform="rotate(337)"/>
        <circle class="pb-flower-part" id="pb-fc1" cx="0" cy="0" r="8" fill="#ffbe0b" filter="url(#pb-glow2)"/>
        <circle class="pb-flower-part" id="pb-fc2" cx="0" cy="0" r="5" fill="#f4a800"/>
        <circle class="pb-flower-part" id="pb-fc3" cx="2.5" cy="-2" r="1.2" fill="#fff" opacity="0.8"/>
        <circle class="pb-flower-part" id="pb-fc4" cx="-2" cy="1.5" r="1.2" fill="#fff" opacity="0.8"/>
        <circle class="pb-flower-part" id="pb-fc5" cx="0.5" cy="2.5" r="1" fill="#fff" opacity="0.8"/>
      </g>

      <defs>
        <clipPath id="pb-can-clip">
          <rect id="pb-can-clip-rect" x="14" y="30" width="52" height="42" rx="4"/>
        </clipPath>
        <filter id="pb-glow" x="-60%" y="-60%" width="220%" height="220%">
          <feGaussianBlur stdDeviation="5" result="b"/>
          <feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge>
        </filter>
        <filter id="pb-glow2" x="-60%" y="-60%" width="220%" height="220%">
          <feGaussianBlur stdDeviation="2.5" result="b"/>
          <feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge>
        </filter>
      </defs>
    </svg>
  </div>

  <div class="pb-divider"></div>

  <!-- Watering can side -->
  <div class="pb-can-side">
    <div class="pb-status" id="pb-status">Answer correctly to fill the can</div>

    <div class="pb-can-wrap" id="pb-can-wrap" onclick="PlantProgress._onCanClick()">
      <svg id="pb-can-svg" viewBox="0 0 110 90">
        <defs>
          <clipPath id="water-clip">
            <rect id="pb-water-clip-rect" x="14" y="10" width="52" height="55" rx="4"/>
          </clipPath>
          <filter id="can-glow" x="-30%" y="-30%" width="160%" height="160%">
            <feGaussianBlur stdDeviation="3" result="b"/>
            <feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge>
          </filter>
        </defs>

        <!-- Can body -->
        <rect x="14" y="18" width="52" height="48" rx="5" fill="#1a2e1e" stroke="#2a4d2e" stroke-width="1.5"/>

        <!-- Water fill (clipped) -->
        <rect id="pb-water-fill" x="14" y="66" width="52" height="0" rx="4"
              fill="#3a9ad9" opacity="0.75" clip-path="url(#water-clip)"/>

        <!-- Water shimmer lines -->
        <g id="pb-shimmer" opacity="0" clip-path="url(#water-clip)">
          <line x1="20" y1="55" x2="30" y2="55" stroke="rgba(255,255,255,0.2)" stroke-width="1" stroke-linecap="round"/>
          <line x1="36" y1="58" x2="50" y2="58" stroke="rgba(255,255,255,0.15)" stroke-width="1" stroke-linecap="round"/>
          <line x1="24" y1="62" x2="40" y2="62" stroke="rgba(255,255,255,0.1)" stroke-width="1" stroke-linecap="round"/>
        </g>

        <!-- Can body outline (on top of water) -->
        <rect x="14" y="18" width="52" height="48" rx="5" fill="none" stroke="#3d7a4a" stroke-width="1.5"/>

        <!-- Spout -->
        <path d="M66,30 C80,28 90,32 95,38" stroke="#3d7a4a" stroke-width="3" fill="none" stroke-linecap="round"/>
        <!-- Spout tip holes -->
        <circle cx="95" cy="38" r="3" fill="#1a2e1e" stroke="#3d7a4a" stroke-width="1"/>
        <circle cx="93" cy="41" r="1.5" fill="#3d7a4a" opacity="0.6"/>
        <circle cx="97" cy="40" r="1.2" fill="#3d7a4a" opacity="0.5"/>
        <circle cx="95" cy="43" r="1" fill="#3d7a4a" opacity="0.4"/>

        <!-- Handle -->
        <path d="M22,22 C10,22 6,32 6,38 C6,46 10,54 22,54" stroke="#3d7a4a" stroke-width="2.5" fill="none" stroke-linecap="round"/>

        <!-- Lid -->
        <rect x="18" y="14" width="44" height="7" rx="3" fill="#1e3a22" stroke="#3d7a4a" stroke-width="1.2"/>
        <rect x="34" y="10" width="12" height="6" rx="2" fill="#1e3a22" stroke="#3d7a4a" stroke-width="1"/>

        <!-- Water level tick marks -->
        <line x1="68" y1="30" x2="72" y2="30" stroke="#2a4d2e" stroke-width="1"/>
        <line x1="68" y1="38" x2="72" y2="38" stroke="#2a4d2e" stroke-width="1"/>
        <line x1="68" y1="46" x2="72" y2="46" stroke="#2a4d2e" stroke-width="1"/>
        <line x1="68" y1="54" x2="72" y2="54" stroke="#2a4d2e" stroke-width="1"/>
        <line x1="68" y1="62" x2="72" y2="62" stroke="#2a4d2e" stroke-width="1"/>
      </svg>
    </div>

    <!-- 8 dot indicators -->
    <div class="pb-water-dots" id="pb-dots"></div>
    <div class="pb-can-label" id="pb-can-label">0 / 8 correct</div>
  </div>

  <div class="pb-soil-bar"></div>
</div>
<!-- ============================================= -->

<script>
/* =============================================
   [MODULE JS] â€” PlantProgress API
   
   Public methods:
     PlantProgress.addWater()   â†’ Call on correct answer
     PlantProgress.reset()      â†’ Reset everything
   
   Events dispatched on document:
     'canFull'       â†’ Can is full, ready to water
     'plantWatered'  â†’ Plant was watered (detail: { wateringCount })
     'plantFullyGrown' â†’ Plant reached full bloom
   ============================================= */

const PlantProgress = (() => {

  const TOTAL_WATERS = 8;         // waterings to full bloom
  const ANSWERS_PER_CAN = 5;      // correct answers to fill one can

  let correctCount = 0;           // answers since last watering
  let wateringsDone = 0;          // times plant has been watered
  let isAnimating = false;

  // ---- DOM refs ----
  const canWrap    = document.getElementById('pb-can-wrap');
  const waterFill  = document.getElementById('pb-water-fill');
  const shimmer    = document.getElementById('pb-shimmer');
  const statusEl   = document.getElementById('pb-status');
  const labelEl    = document.getElementById('pb-can-label');
  const dotsEl     = document.getElementById('pb-dots');

  // Plant refs
  const stem       = document.getElementById('pb-stem');
  const seed       = document.getElementById('pb-seed');
  const bloomGlow  = document.getElementById('pb-bloom-glow');

  const STEM_LENGTH = 180;

  // ---- Build dots ----
  function buildDots() {
    dotsEl.innerHTML = '';
    for (let i = 0; i < ANSWERS_PER_CAN; i++) {
      const d = document.createElement('div');
      d.className = 'pb-dot';
      d.id = 'pb-dot-' + i;
      dotsEl.appendChild(d);
    }
  }

  // ---- Fill can water level ----
  function updateCanFill(count) {
    // count: 0â€“ANSWERS_PER_CAN
    const pct = count / ANSWERS_PER_CAN;
    const totalH = 48; // inner can height (y18 to y66)
    const fillH = Math.round(totalH * pct);
    const fillY = 66 - fillH;
    waterFill.setAttribute('y', fillY);
    waterFill.setAttribute('height', fillH);
    shimmer.style.opacity = pct > 0.2 ? 0.8 : 0;

    // Update dots
    for (let i = 0; i < ANSWERS_PER_CAN; i++) {
      const dot = document.getElementById('pb-dot-' + i);
      if (!dot) continue;
      if (i < count) {
        if (!dot.classList.contains('filled')) {
          dot.classList.add('filled', 'just-filled');
          setTimeout(() => dot.classList.remove('just-filled'), 400);
        }
      } else {
        dot.classList.remove('filled', 'just-filled');
      }
    }

    labelEl.textContent = `${correctCount} / ${ANSWERS_PER_CAN} to fill`;
  }

  // ---- Can full state ----
  function setCanFull(full) {
    if (full) {
      canWrap.classList.add('full');
      // Add pulse ring
      if (!document.getElementById('pb-full-ring')) {
        const ring = document.createElement('div');
        ring.className = 'pb-full-ring';
        ring.id = 'pb-full-ring';
        canWrap.appendChild(ring);
      }
      setStatus('Can is full â€” click to water! ðŸ’§', 'highlight');
      labelEl.textContent = 'Ready to water!';
      document.dispatchEvent(new CustomEvent('canFull'));
    } else {
      canWrap.classList.remove('full');
      const ring = document.getElementById('pb-full-ring');
      if (ring) ring.remove();
    }
  }

  // ---- Status text ----
  function setStatus(msg, cls = '') {
    statusEl.textContent = msg;
    statusEl.className = 'pb-status ' + cls;
  }

  // ---- Splash effect ----
  function doSplash() {
    const wrap = document.querySelector('.pb-plant-side');
    const rect = wrap.getBoundingClientRect();
    // Drop particles from can spout area toward soil
    const cx = rect.width / 2;
    const cy = rect.height * 0.85;

    for (let i = 0; i < 10; i++) {
      const drop = document.createElement('div');
      drop.className = 'pb-splash-drop';
      const size = 4 + Math.random() * 5;
      drop.style.width = size + 'px';
      drop.style.height = size + 'px';
      drop.style.left = (cx + (Math.random() - 0.5) * 60) + 'px';
      drop.style.top = cy + 'px';
      const tx = (Math.random() - 0.5) * 40;
      const ty = -(10 + Math.random() * 25);
      drop.style.setProperty('--tx', tx + 'px');
      drop.style.setProperty('--ty', ty + 'px');
      drop.style.animationDelay = (Math.random() * 0.15) + 's';
      drop.style.animationDuration = (0.5 + Math.random() * 0.3) + 's';
      wrap.appendChild(drop);
      setTimeout(() => drop.remove(), 900);
    }

    // Pour stream from can area
    const stream = document.createElement('div');
    stream.className = 'pb-pour-stream';
    stream.style.left = (cx + 30) + 'px';
    stream.style.top = (cy - 60) + 'px';
    wrap.appendChild(stream);
    setTimeout(() => stream.remove(), 600);
  }

  // ---- Grow plant to stage ----
  function growPlant(stage) {
    // stage: 1â€“8
    const progress = stage / TOTAL_WATERS; // 0.125 to 1.0

    // Seed fades after stage 1
    seed.setAttribute('opacity', stage >= 2 ? 0 : 1);

    // Stem: starts at stage 1, full at stage 5
    const stemT = Math.min(progress / 0.625, 1); // full at 5/8
    stem.style.strokeDashoffset = STEM_LENGTH * (1 - stemT);

    // Leaf L1: stage 3
    const l1 = document.getElementById('pb-leaf-l1');
    l1.style.transform = stage >= 3 ? 'scale(1)' : 'scale(0)';

    // Leaf R1: stage 4
    const r1 = document.getElementById('pb-leaf-r1');
    r1.style.transform = stage >= 4 ? 'scale(1)' : 'scale(0)';

    // Leaf L2: stage 5
    const l2 = document.getElementById('pb-leaf-l2');
    l2.style.transform = stage >= 5 ? 'scale(1)' : 'scale(0)';

    // Petals: stage 6 onward
    for (let i = 0; i < 16; i++) {
      const el = document.getElementById('pp' + i);
      if (!el) continue;
      const petalStage = 6 + (i / 16) * 2; // spread from stage 6 to 8
      const show = stage >= petalStage;
      el.style.opacity = show ? 1 : 0;
      el.style.transform = el.getAttribute('transform') + (show ? ' scale(1)' : ' scale(0)');
    }

    // Flower center: stage 7+
    const centerShow = stage >= 7;
    ['pb-fc1','pb-fc2','pb-fc3','pb-fc4','pb-fc5'].forEach(id => {
      const el = document.getElementById(id);
      if (el) el.style.transform = centerShow ? 'scale(1)' : 'scale(0)';
    });

    // Bloom glow: stage 8
    bloomGlow.style.opacity = stage >= 8 ? '0.4' : '0';

    // Full bloom sparkles
    if (stage === 8) spawnBloomSparkles();
  }

  // ---- Bloom sparkles ----
  let sparkleInt = null;
  function spawnBloomSparkles() {
    if (sparkleInt) return;
    const wrap = document.querySelector('.pb-plant-side');
    let count = 0;
    sparkleInt = setInterval(() => {
      count++;
      if (count > 20) { clearInterval(sparkleInt); sparkleInt = null; return; }
      const s = document.createElement('div');
      s.style.cssText = `
        position:absolute; width:4px; height:4px; border-radius:50%;
        background:${Math.random()>0.5?'#ffbe0b':'#f9c784'};
        pointer-events:none;
        left:${60 + Math.cos(Math.random()*Math.PI*2)*20}px;
        top:${30 + Math.sin(Math.random()*Math.PI*2)*20}px;
      `;
      wrap.appendChild(s);
      s.animate([
        { opacity: 0, transform: 'scale(0)' },
        { opacity: 1, transform: 'scale(1)', offset: 0.3 },
        { opacity: 0, transform: `scale(0) translate(${(Math.random()-0.5)*30}px,${-15-Math.random()*20}px)` }
      ], { duration: 700 + Math.random()*300, easing: 'ease-out' }).onfinish = () => s.remove();
    }, 120);
  }

  // ---- Can click handler ----
  function _onCanClick() {
    if (!canWrap.classList.contains('full') || isAnimating) return;
    isAnimating = true;

    // Drain the can
    setCanFull(false);
    correctCount = 0;
    updateCanFill(0);

    // Splash
    doSplash();

    // Grow plant after short delay
    setTimeout(() => {
      wateringsDone++;
      growPlant(wateringsDone);

      if (wateringsDone >= TOTAL_WATERS) {
        setStatus('ðŸŒ¸ Full bloom! Your plant is complete!', 'bloom');
        labelEl.textContent = 'Garden complete!';
        canWrap.style.pointerEvents = 'none';
        document.dispatchEvent(new CustomEvent('plantFullyGrown'));
      } else {
        const remaining = TOTAL_WATERS - wateringsDone;
        setStatus(`Watering ${wateringsDone}/${TOTAL_WATERS} â€” keep going!`, '');
        labelEl.textContent = `${correctCount} / ${ANSWERS_PER_CAN} to fill`;
        document.dispatchEvent(new CustomEvent('plantWatered', {
          detail: { wateringCount: wateringsDone }
        }));
      }

      isAnimating = false;
    }, 400);
  }

  // ---- Public: addWater ----
  function addWater() {
    if (wateringsDone >= TOTAL_WATERS) return;
    if (canWrap.classList.contains('full')) return;

    correctCount++;
    updateCanFill(correctCount);

    if (correctCount >= ANSWERS_PER_CAN) {
      setCanFull(true);
    } else {
      const left = ANSWERS_PER_CAN - correctCount;
      setStatus(`${left} more correct answer${left !== 1 ? 's' :